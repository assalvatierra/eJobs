@model IEnumerable<JobsV1.Models.SalesLead>

@{
    ViewBag.Title = "Leads";
    var SalesStatCode = (List < JobsV1.Models.SalesStatusCode >) ViewBag.StatusCodes;
}

<h2>Leads</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">

@foreach (var item in Model)
{
    <tr>
        <td>
            
            <br />
            @foreach (var salescat in item.SalesLeadCategories)
            {
                <img src=@Url.Content(@salescat.SalesLeadCatCode.iconPath)
                      alt=@salescat.SalesLeadCatCode.CatName height="24"
                     title=@salescat.SalesLeadCatCode.CatName />
            }
        </td>
        <td>
            <div style="background-color:lightgray;">
                @foreach (var salesstat in SalesStatCode)
                {
                    if(item.SalesStatus.Select(s=>s.SalesStatusCodeId).Contains(salesstat.Id))
                    {
                        <span style="font-weight:800; color: gray">
                            @Html.ActionLink(salesstat.Name, "AddSalesStatus", new { slId = item.Id, StatusId = salesstat.Id }) &nbsp;>
                        </span>
                    }
                    else
                    {
                        <span>
                            @Html.ActionLink(salesstat.Name, "AddSalesStatus", new { slId = item.Id, StatusId = salesstat.Id }) &nbsp;>
                        </span>

                    }
                }
            </div>
            <div>
                Account: @Html.DisplayFor(modelItem => item.Customer.Name) |
                @Html.DisplayFor(modelItem => item.CustName)
                [ @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                @Html.ActionLink("Delete", "Delete", new { id = item.Id }) |
                @Html.ActionLink("Profitability","SalesLeadCat", new { id = item.Id }) | 
                @Html.ActionLink("Add Request", "ListActivityCodes", new { id = item.Id })
                
                ]


                <br />
                [ @Html.DisplayFor(modelItem => item.Date) ]
                @Html.DisplayFor(modelItem => item.Details)
                <br />@Html.DisplayFor(modelItem => item.Remarks)

                <br />
                @if( item.SalesActivities.Count()>0)
                {
                    <span style="font:bold 8px, arial, verdana; color: blue;">
                        Activities<br />
                    </span>

                    foreach (var tmpAct in item.SalesActivities)
                    {
                        if (tmpAct.SalesActStatusId == 1)
                        { 
                            <span style="color:red;font-weight:800;">! </span>
                            <span>@tmpAct.Particulars - @tmpAct.DtActivity.ToString("MMM-dd-yyyy")</span>
                            @Html.ActionLink("Done", "SalesActivityDone", new { id = tmpAct.Id })
                            <br />
                        }
                        if (tmpAct.SalesActStatusId == 2)
                        {
                            <span style="color:red;font-weight:800;">&#10004; </span>
                            <span>@tmpAct.Particulars - @tmpAct.DtActivity.ToString("MMM-dd-yyyy")</span>
                            <br />
                        }
                        if (tmpAct.SalesActStatusId == 3)
                        {
                            <span style="color:red;font-weight:800;">&#x2022; </span>
                            <span>@tmpAct.Particulars - @tmpAct.DtActivity.ToString("MMM-dd-yyyy")</span>
                            <br />
                        }
                    }
                }

                <br />
                <span style="font: status-bar; color:gray;">
                    Entered: @Html.DisplayFor(modelItem => item.EnteredBy)
                    @@ @Html.DisplayFor(modelItem => item.DtEntered)
                </span>
            </div>

        </td>

    </tr>
}

</table>
