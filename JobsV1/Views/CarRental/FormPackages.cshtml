
<div class="modal-content" style="min-width:600px;">
    <div class="modal-header">
        <h3 class="modal-title">Car Packages </h3>

        <a href="#" onclick="PrevForm()"> Previous      </a>&bull;
        <a href="#" onclick="FormPackages_NextForm()"> Proceed         </a>

        <h5 id="modal-text-foot">-</h5>
    </div>

    <div class="form-horizontal">
        <div class="col-md-12">
            <h4>Please Select a Package</h4>
        </div>
        <div class="col-md-12" id="pkg-table">
            <table class="table table-bordered table-hover" id="table-packages" style="width:96%;margin-right:50px">
                <tr>
                    <th>Package</th>
                    <th>Driver Accomodation/Meals</th>
                    <th>Fuel</th>
                    <th>No Days</th>
                    <th>Rate </th>
                </tr>

                @foreach (var package in ViewBag.PackageList as IEnumerable<JobsV1.Models.PackageTable>)
                {
                    if (package.Id == 1)
                    {

                        <tr class="clickable-row" id="pkg-@(package.Id)"  style="display:none;" title="@(package.Id)" data-toggle="popover">
                            <td id="pkg-desc">@package.Description</td>
                            <td id="pkg-meal@(package.Id)">@package.TextMeals</td>
                            <td id="pkg-fuel@(package.Id)">@package.TextFuel</td>
                            <td id="pkg-days@(package.Id)">@package.Days</td>
                            <td>
                                <span id="pkg-rate@(package.Id)">  @package.TextRate </span>
                                <b id="pkg-total@(package.Id)"> =  @package.Rate</b>
                            </td>
                        </tr>
                    }
                    else
                    {

                    <tr class="clickable-row" id="pkg-@(package.Id)" title="@(package.Id)" data-toggle="popover">
                        <td id="pkg-desc">@package.Description</td>
                        <td id="pkg-meal@(package.Id)">@package.TextMeals</td>
                        <td id="pkg-fuel@(package.Id)">@package.TextFuel</td>
                        <td id="pkg-days@(package.Id)">@package.Days</td>
                        <td>
                            <span id="pkg-rate@(package.Id)">  @package.TextRate </span>
                            <b id="pkg-total@(package.Id)"> =  @package.Rate</b>
                        </td>
                    </tr>
                    }
                }

            </table>
        </div>

        <div style="margin:35px;">


        </div>
    </div>

    <div class="modal-footer" id="rsv-footer" style="display:block;">

        <div class="pull-right">
            <button class="btn btn-default" onclick="PrevForm()">Previous</button>

            <button class="btn btn-default" onclick="FormPackages_NextForm()"> Next </button>
            @Html.ActionLink("Cancel", "Index", "CarRental", null, new { @class = "btn btn-default" })

        </div>
    </div>
</div>


<script type="text/javascript" src="~/Scripts/jquery-3.3.1.js"></script>
<script type="text/javascript" src="~/Scripts/Job/FormRenter.js"></script>
<script type="text/javascript" src="~/Scripts/CarRental/Reservation_wDriver.js"></script>

<script>
    var selectedTour = 1; //selected package id
    function FormPackages_NextForm() {
        var rentalType = @ViewBag.rentalType;
        var carId = @ViewBag.carId;
        var noDays = @ViewBag.days;
        var mealsAcc = @ViewBag.meals;
        var fuel = @ViewBag.fuel;

        console.log("Rental:"      + rentalType );
        console.log("selectedCar:" + carId      );
        console.log("NoDays:"      + noDays     );
        console.log("MealsAcc:"    + mealsAcc   );
        console.log("Fuel:"        + fuel       );

        FormPackages(carId, noDays, rentalType, mealsAcc, fuel, selectedTour);

    }

    function PrevForm() {
        var rentalType = @ViewBag.rentalType;
        var carId = @ViewBag.carId;
        var noDays = @ViewBag.days;
        var mealsAcc = @ViewBag.meals;
        var fuel = @ViewBag.fuel;

        console.log("Rental:"      + rentalType );
        console.log("selectedCar:" + carId      );
        console.log("NoDays:"      + noDays     );
        console.log("MealsAcc:"    + mealsAcc   );
        console.log("Fuel:"        + fuel       );

        FormCarReserve(carId, noDays, rentalType, mealsAcc, fuel, selectedTour);
    }

    //public PartialViewResult FormPackages (int? carId, int? days, int? rentType, int? meals, int? fuel)

    function FormPackages(carId, noDays, rentalType, meals, fuel, pkg) {
        window.location.href = '/CarRental/FormSummary?carId=' + carId + '&days=' + noDays +
            '&rentType=' + rentalType + '&meals=' + meals + '&fuel=' + fuel + '&pkg=' + pkg;
    }

    //public PartialViewResult FormPackages (int? carId, int? days, int? rentType, int? meals, int? fuel)
    function FormCarReserve(carId, noDays, rentalType, meals, fuel, pkg) {
        window.location.href = '/CarRental/CarReserve?id=' + carId + '&days=' + noDays +
            '&rentType=' + rentalType + '&meals=' + meals + '&fuel=' + fuel + '&pkg=' + pkg;
    }

    //next popup on formpackages package list
    $(document).ready(function () {
        $('[data-toggle="popover"]').popover({
            placement: 'right',
            html: 'true',
            content: '<button class="btn btn-primary" onclick="FormPackages_NextForm();">Proceed</button>'
        });

        $('[data-toggle="popover"]').on('click', function (e) {
            $('[data-toggle="popover"]').not(this).popover('hide');
        });

        $('#pkg-table').on('click', '.clickable-row', function (event) {
            $(this).addClass('active').siblings().removeClass('active');
            selectedTour = $(this).attr('id').substring(4,6);
            console.log(selectedTour);
        });
        updateTransactionText();
    });

    function updateTransactionText() {

        var rentalType = @ViewBag.rentTypeTxt;
        var carId = @ViewBag.carId;
        var noDays = @ViewBag.days;
        var mealsAcc = @ViewBag.meals;
        var fuel = @ViewBag.fuel;

        console.log("test");

        var mealPackage = mealsAcc == '1' ? 'Driver Meals/Accomodation Included ' : 'Driver Meals/Accomodation by renter';
        var fuelPackage = fuel == '1' ? 'Driver Fuel Included ' : 'Driver Fuel by renter';
        $('#modal-text-foot').text('@ViewBag.RentTypeTxt  - @ViewBag.carDesc - ' + noDays + ' Days - ' + mealPackage + ' - ' + fuelPackage + '');
    }

</script>